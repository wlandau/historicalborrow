<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Hierarchical model MCMC — hb_mcmc_hierarchical • historicalborrow</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Hierarchical model MCMC — hb_mcmc_hierarchical"><meta property="og:description" content="Run the hierarchical model with MCMC."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">historicalborrow</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.2.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/methods.html">Methods</a>
    </li>
    <li>
      <a href="../articles/usage.html">Usage</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/wlandau/historicalborrow/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Hierarchical model MCMC</h1>
    <small class="dont-index">Source: <a href="https://github.com/wlandau/historicalborrow/blob/HEAD/R/hb_mcmc_hierarchical.R" class="external-link"><code>R/hb_mcmc_hierarchical.R</code></a></small>
    <div class="hidden name"><code>hb_mcmc_hierarchical.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Run the hierarchical model with MCMC.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">hb_mcmc_hierarchical</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  response <span class="op">=</span> <span class="st">"response"</span>,</span>
<span>  study <span class="op">=</span> <span class="st">"study"</span>,</span>
<span>  study_reference <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">data</span><span class="op">[[</span><span class="va">study</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,</span>
<span>  group <span class="op">=</span> <span class="st">"group"</span>,</span>
<span>  group_reference <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">data</span><span class="op">[[</span><span class="va">group</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,</span>
<span>  patient <span class="op">=</span> <span class="st">"patient"</span>,</span>
<span>  covariates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"^covariate"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span>, value <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  s_delta <span class="op">=</span> <span class="fl">30</span>,</span>
<span>  s_beta <span class="op">=</span> <span class="fl">30</span>,</span>
<span>  s_sigma <span class="op">=</span> <span class="fl">30</span>,</span>
<span>  s_mu <span class="op">=</span> <span class="fl">30</span>,</span>
<span>  s_tau <span class="op">=</span> <span class="fl">30</span>,</span>
<span>  n_chains <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  n_adapt <span class="op">=</span> <span class="fl">2000</span>,</span>
<span>  n_warmup <span class="op">=</span> <span class="fl">4000</span>,</span>
<span>  n_iterations <span class="op">=</span> <span class="fl">20000</span>,</span>
<span>  quiet <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>data</dt>
<dd><p>Tidy data frame with one row per patient,
indicator columns for the response variable,
study, group, and patient,
and covariates. All columns must be atomic vectors
(e.g. not lists). The data for the mixture and simple models
should have just one study,
and the others should have
data from more than one study. The simple model can be used
to get the historical data components of <code>m_omega</code> and <code>s_omega</code>
for the mixture model.</p></dd>


<dt>response</dt>
<dd><p>Character of length 1,
name of the column in <code>data</code> with the response/outcome variable.
<code>data[[response]]</code> must be a continuous variable,
and it <em>should</em> be the change from baseline of a
clinical endpoint of interest, as opposed to just
the raw response. Treatment differences
are computed directly from this scale, please supply
change from baseline unless you are absolutely certain
that treatment differences computed directly from
this quantity are clinically meaningful.</p></dd>


<dt>study</dt>
<dd><p>Character of length 1,
name of the column in <code>data</code> with the study ID.</p></dd>


<dt>study_reference</dt>
<dd><p>Atomic of length 1,
element of the <code>study</code> column that indicates
the current study.
(The other studies are historical studies.)</p></dd>


<dt>group</dt>
<dd><p>Character of length 1,
name of the column in <code>data</code> with the group ID.</p></dd>


<dt>group_reference</dt>
<dd><p>Atomic of length 1,
element of the <code>group</code> column that indicates
the control group.
(The other groups may be treatment groups.)</p></dd>


<dt>patient</dt>
<dd><p>Character of length 1,
name of the column in <code>data</code> with the patient ID.</p></dd>


<dt>covariates</dt>
<dd><p>Character vector of column names
in <code>data</code> with the columns with baseline covariates.
These can be continuous, categorical, or binary.
Regardless, <code>historicalborrow</code> derives the appropriate
model matrix.</p></dd>


<dt>s_delta</dt>
<dd><p>Numeric of length 1, prior standard deviation
of the study-by-group effect parameters <code>delta</code>.</p></dd>


<dt>s_beta</dt>
<dd><p>Numeric of length 1, prior standard deviation
of the fixed effects <code>beta</code>.</p></dd>


<dt>s_sigma</dt>
<dd><p>Numeric of length 1, prior upper bound
of the residual standard deviations.</p></dd>


<dt>s_mu</dt>
<dd><p>Positive numeric of length 1,
hyperparameter: prior standard deviation of the
mean <code>mu</code> of the study-level control means <code>alpha</code>.</p></dd>


<dt>s_tau</dt>
<dd><p>Positive numeric of length 1,
hyperparameter: uniform  prior upper bound of the
standard deviation <code>tau</code> of the study-level control means <code>alpha</code>.</p></dd>


<dt>n_chains</dt>
<dd><p>Number of MCMC chains to run.</p></dd>


<dt>n_adapt</dt>
<dd><p>Number of adaptation iterations to run.</p></dd>


<dt>n_warmup</dt>
<dd><p>Number of warmup iterations per chain to run.</p></dd>


<dt>n_iterations</dt>
<dd><p>Number of saved MCMC iterations per chain to run.</p></dd>


<dt>quiet</dt>
<dd><p>Logical of length 1, <code>TRUE</code> to suppress R console output.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>A tidy data frame of parameter samples from the
posterior distribution. Columns <code>.chain</code>, <code>.iteration</code>,
and <code>.draw</code> have the meanings documented in the
<code>posterior</code> package.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p>Other mcmc: 
<code><a href="hb_convergence.html">hb_convergence</a>()</code>,
<code><a href="hb_mcmc_independent.html">hb_mcmc_independent</a>()</code>,
<code><a href="hb_mcmc_mixture_hyperparameters.html">hb_mcmc_mixture_hyperparameters</a>()</code>,
<code><a href="hb_mcmc_mixture.html">hb_mcmc_mixture</a>()</code>,
<code><a href="hb_mcmc_pool.html">hb_mcmc_pool</a>()</code></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="hb_sim_hierarchical.html">hb_sim_hierarchical</a></span><span class="op">(</span>n_continuous <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">$</span><span class="va">data</span></span></span>
<span class="r-in"><span><span class="fu">hb_mcmc_hierarchical</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">data</span>,</span></span>
<span class="r-in"><span>  n_chains <span class="op">=</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>  n_adapt <span class="op">=</span> <span class="fl">100</span>,</span></span>
<span class="r-in"><span>  n_warmup <span class="op">=</span> <span class="fl">50</span>,</span></span>
<span class="r-in"><span>  n_iterations <span class="op">=</span> <span class="fl">50</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 50 × 28</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    `alpha[1]` `alpha[2]` alpha…¹ alpha…² alpha…³ beta[…⁴ beta[…⁵ beta[…⁶ beta[…⁷</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 1</span>      -<span style="color: #BB0000;">1.67</span>      -<span style="color: #BB0000;">1.72</span>   -<span style="color: #BB0000;">1.68</span>   -<span style="color: #BB0000;">1.71</span>   -<span style="color: #BB0000;">1.70</span>    1.33 -<span style="color: #BB0000;">0.255</span>   -<span style="color: #BB0000;">0.273</span>   0.386</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 2</span>      -<span style="color: #BB0000;">1.71</span>      -<span style="color: #BB0000;">1.73</span>   -<span style="color: #BB0000;">1.68</span>   -<span style="color: #BB0000;">1.74</span>   -<span style="color: #BB0000;">1.70</span>    1.52 -<span style="color: #BB0000;">0.306</span>   -<span style="color: #BB0000;">0.143</span>   0.349</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 3</span>      -<span style="color: #BB0000;">1.67</span>      -<span style="color: #BB0000;">1.70</span>   -<span style="color: #BB0000;">1.71</span>   -<span style="color: #BB0000;">1.72</span>   -<span style="color: #BB0000;">1.70</span>    1.51 -<span style="color: #BB0000;">0.031</span><span style="color: #BB0000; text-decoration: underline;">6</span>  -<span style="color: #BB0000;">0.163</span>   0.325</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 4</span>      -<span style="color: #BB0000;">1.73</span>      -<span style="color: #BB0000;">1.74</span>   -<span style="color: #BB0000;">1.70</span>   -<span style="color: #BB0000;">1.73</span>   -<span style="color: #BB0000;">1.69</span>    1.47 -<span style="color: #BB0000;">0.092</span><span style="color: #BB0000; text-decoration: underline;">9</span>  -<span style="color: #BB0000;">0.201</span>   0.279</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 5</span>      -<span style="color: #BB0000;">1.71</span>      -<span style="color: #BB0000;">1.69</span>   -<span style="color: #BB0000;">1.68</span>   -<span style="color: #BB0000;">1.72</span>   -<span style="color: #BB0000;">1.73</span>    1.58 -<span style="color: #BB0000;">0.337</span>   -<span style="color: #BB0000;">0.318</span>   0.268</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 6</span>      -<span style="color: #BB0000;">1.70</span>      -<span style="color: #BB0000;">1.74</span>   -<span style="color: #BB0000;">1.74</span>   -<span style="color: #BB0000;">1.70</span>   -<span style="color: #BB0000;">1.74</span>    1.58 -<span style="color: #BB0000;">0.107</span>   -<span style="color: #BB0000;">0.183</span>   0.343</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 7</span>      -<span style="color: #BB0000;">1.68</span>      -<span style="color: #BB0000;">1.72</span>   -<span style="color: #BB0000;">1.64</span>   -<span style="color: #BB0000;">1.70</span>   -<span style="color: #BB0000;">1.69</span>    1.43 -<span style="color: #BB0000;">0.260</span>   -<span style="color: #BB0000;">0.227</span>   0.334</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 8</span>      -<span style="color: #BB0000;">1.74</span>      -<span style="color: #BB0000;">1.78</span>   -<span style="color: #BB0000;">1.69</span>   -<span style="color: #BB0000;">1.72</span>   -<span style="color: #BB0000;">1.65</span>    1.50 -<span style="color: #BB0000;">0.323</span>   -<span style="color: #BB0000;">0.179</span>   0.364</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 9</span>      -<span style="color: #BB0000;">1.69</span>      -<span style="color: #BB0000;">1.74</span>   -<span style="color: #BB0000;">1.64</span>   -<span style="color: #BB0000;">1.70</span>   -<span style="color: #BB0000;">1.68</span>    1.44 -<span style="color: #BB0000;">0.369</span>   -<span style="color: #BB0000;">0.214</span>   0.397</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">10</span>      -<span style="color: #BB0000;">1.60</span>      -<span style="color: #BB0000;">1.77</span>   -<span style="color: #BB0000;">1.67</span>   -<span style="color: #BB0000;">1.71</span>   -<span style="color: #BB0000;">1.69</span>    1.39 -<span style="color: #BB0000;">0.216</span>   -<span style="color: #BB0000;">0.168</span>   0.269</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># … with 40 more rows, 19 more variables: `beta[5]` &lt;dbl&gt;, `beta[6]` &lt;dbl&gt;,</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;">#   `beta[7]` &lt;dbl&gt;, `beta[8]` &lt;dbl&gt;, `beta[9]` &lt;dbl&gt;, `beta[10]` &lt;dbl&gt;,</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;">#   `delta[1]` &lt;dbl&gt;, `delta[2]` &lt;dbl&gt;, mu &lt;dbl&gt;, precision_ratio &lt;dbl&gt;,</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;">#   `sigma[1]` &lt;dbl&gt;, `sigma[2]` &lt;dbl&gt;, `sigma[3]` &lt;dbl&gt;, `sigma[4]` &lt;dbl&gt;,</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;">#   `sigma[5]` &lt;dbl&gt;, tau &lt;dbl&gt;, .chain &lt;int&gt;, .iteration &lt;int&gt;, .draw &lt;int&gt;,</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;">#   and abbreviated variable names ¹​`alpha[3]`, ²​`alpha[4]`, ³​`alpha[5]`,</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;">#   ⁴​`beta[1]`, ⁵​`beta[2]`, ⁶​`beta[3]`, ⁷​`beta[4]`</span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by William Michael Landau.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer></div>

  


  

  </body></html>

