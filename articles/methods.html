<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Methods • historicalborrow</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Methods">
<meta property="og:description" content="historicalborrow">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">historicalborrow</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.3.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/methods.html">Methods</a>
    </li>
    <li>
      <a href="../articles/usage.html">Usage</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/wlandau/historicalborrow/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="methods_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Methods</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/wlandau/historicalborrow/blob/HEAD/vignettes/methods.Rmd" class="external-link"><code>vignettes/methods.Rmd</code></a></small>
      <div class="hidden name"><code>methods.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://wlandau.github.io/historicalborrow/" class="external-link">historicalborrow</a></span><span class="op">)</span></span></code></pre></div>
<p>This vignette defines the models and historical borrowing metrics supported in the <code>historicalborrow</code> package.</p>
<div class="section level2">
<h2 id="models">Models<a class="anchor" aria-label="anchor" href="#models"></a>
</h2>
<div class="section level3">
<h3 id="common-notation">Common notation<a class="anchor" aria-label="anchor" href="#common-notation"></a>
</h3>
<ul>
<li>
<span class="math inline">\(y\)</span>: vector of patient-specific clinical responses to a continuous outcome variable. Ideally, the outcome variable should be some form of change from baseline, not the response itself. If the outcome is the raw response, then the treatment effect will not be meaningful.</li>
<li>
<span class="math inline">\(y_{ij}\)</span>: the element of <span class="math inline">\(y\)</span> corresponding to study <span class="math inline">\(i\)</span> patient <span class="math inline">\(j\)</span>.</li>
<li>
<span class="math inline">\((X)_{ij}\)</span>: the row of matrix <span class="math inline">\(X\)</span> corresponding to study <span class="math inline">\(i\)</span> patient <span class="math inline">\(j\)</span>.</li>
<li>
<span class="math inline">\(\alpha\)</span>: Vector of control group mean parameters, one for each study. The first elements are for the historical studies, and the last one is for the current study.</li>
<li>
<span class="math inline">\(\delta\)</span>: Vector of study-specific treatment mean parameters. There is one for each combination of study and non-control treatment group.</li>
<li>
<span class="math inline">\(d\)</span>: integer index for the elements of <span class="math inline">\(\delta\)</span>.</li>
<li>
<span class="math inline">\(b\)</span>: integer index for the elements of <span class="math inline">\(\beta\)</span>.</li>
<li>
<span class="math inline">\(\beta\)</span>: Vector of study-specific baseline covariate parameters.</li>
<li>
<span class="math inline">\(X_\alpha\)</span>: matrix for the control group mean parameters <span class="math inline">\(\alpha\)</span>. It has indicator columns to select the appropriate element of <span class="math inline">\(\alpha\)</span> for each element of <span class="math inline">\(y\)</span>.</li>
<li>
<span class="math inline">\(X_\delta\)</span>: matrix for the treatment mean parameters <span class="math inline">\(\delta\)</span>. It has indicator columns to select the appropriate element of <span class="math inline">\(\delta\)</span> for each element of <span class="math inline">\(y\)</span>.</li>
<li>
<span class="math inline">\(X_\beta\)</span>: matrix for the baseline covariate fixed effect parameters <span class="math inline">\(\beta\)</span>. It has indicator columns to select the appropriate element of <span class="math inline">\(\beta\)</span> for each element of <span class="math inline">\(y\)</span>.</li>
<li>
<span class="math inline">\(\sigma\)</span>: Vector of study-specific residual standard deviations.</li>
<li>
<span class="math inline">\(I(\cdot)\)</span>: indicator function.</li>
</ul>
</div>
<div class="section level3">
<h3 id="model-matrices">Model matrices<a class="anchor" aria-label="anchor" href="#model-matrices"></a>
</h3>
<p>Each primary model is parameterized thus:</p>
<p><span class="math display">\[
\begin{aligned}
E(y) = X_\alpha \alpha + X_\delta \delta + X_\beta \beta
\end{aligned}
\]</span></p>
<p>Above, <span class="math inline">\(X_\alpha\)</span>, <span class="math inline">\(X_\delta\)</span>, and <span class="math inline">\(X_\beta\)</span> are fixed matrices. <span class="math inline">\(X_\beta\)</span> is a conventional model matrix for the baseline covariates <span class="math inline">\(\beta\)</span>, and the details are explained in the “Baseline covariates” section below. <span class="math inline">\(X_\alpha\)</span> is a matrix of zeroes and ones. It is constructed such that each scalar component of <span class="math inline">\(\alpha\)</span> is the mean response of the control group in a particular study. Likewise, <span class="math inline">\(X_\delta\)</span> is a matrix of zeroes and ones such that each scalar component of <span class="math inline">\(\delta\)</span> is the mean response of a non-control treatment group in a particular study.</p>
<p>To illustrate, let <span class="math inline">\(y_{ijk}\)</span> be patient <span class="math inline">\(i\)</span> in treatment group <span class="math inline">\(j\)</span> (where <span class="math inline">\(j = 1\)</span> is the control group) of study <span class="math inline">\(k\)</span>, and let <span class="math inline">\(\left ( X_\beta \beta \right )_{ijk}\)</span> be the corresponding scalar element of the vector <span class="math inline">\(X_\beta \beta\)</span>. Then,</p>
<p><span class="math display">\[
\begin{aligned}
E(y_{ijk}) = I (j = 1) \alpha_{k} + I (j &gt; 1) \delta_{jk} + \left ( X_\beta \beta \right )_{ijk}
\end{aligned}
\]</span></p>
<p>This parameterization is represented in the more compact expression <span class="math inline">\(X_\alpha \alpha + X_\delta \delta + X_\beta \beta\)</span> in the model definitions in this vignette.</p>
</div>
<div class="section level3">
<h3 id="baseline-covariates">Baseline covariates<a class="anchor" aria-label="anchor" href="#baseline-covariates"></a>
</h3>
<p>The baseline covariates model matrix <span class="math inline">\(X_\beta\)</span> adjusts for baseline covariates. It may contain a continuous column for baseline and binary indicator columns for the levels of user-defined covariates. All these columns are included if possible, but the method automatically drops baseline covariate columns to ensure that the combined model matrix <span class="math inline">\(X_i^* = \left [ {X_\alpha}^* \quad {X_\delta}^* \quad {X_\beta}^* \right ]_i\)</span> is full rank. (Here, <span class="math inline">\(X_i^*\)</span> denotes the rows of matrix <span class="math inline">\(X\)</span> corresponding to study <span class="math inline">\(i\)</span>, with additional rows dropped if the corresponding elements of <span class="math inline">\(y\)</span> are missing. The additional row-dropping based on the missingness of <span class="math inline">\(y\)</span> ensures identifiability even when the user supplies complicated many-leveled factors as covariates.) The choice of columns to drop from <span class="math inline">\({X_\beta}_i\)</span> is determined by the rank and pivoting strategy of the QR decomposition of <span class="math inline">\(X_i\)</span> using the Householder algorithm with pivoting (<code><a href="https://rdrr.io/r/base/qr.html" class="external-link">base::qr()</a></code>, LINPACK routine DQRDC).</p>
<p>Separately within each study, each column of <span class="math inline">\(X_\beta\)</span> is centered to have mean 0, and if possible, scaled to have variance 1. Scaling ensures that the priors on parameters <span class="math inline">\(\beta\)</span> remain relatively diffuse relative to the input data. Study-level centering ensures that the <span class="math inline">\(\alpha\)</span> parameters truly act as <em>unconditional</em> study-specific control group means (as opposed to conditional on the subset of patients at the reference level of <span class="math inline">\(X_\beta\)</span>), and it ensures that borrowing across <span class="math inline">\(\alpha\)</span> components fully presents as control group borrowing.</p>
</div>
<div class="section level3">
<h3 id="post-processing">Post-processing<a class="anchor" aria-label="anchor" href="#post-processing"></a>
</h3>
<p>The <code><a href="../reference/hb_summary.html">hb_summary()</a></code> function post-processes the results from the model. It accepts MCMC samples of parameters and returns interpretable group-level posterior summaries such as change from baseline response and treatment effect. To arrive at these summaries, <code><a href="../reference/hb_summary.html">hb_summary()</a></code> computes marginal posteriors of transformed parameters. The transformations derive patient-level fitted values from model parameters, then derive group-level responses as averages of fitted values. We refer to this style of estimation as “unconditional estimation”, as opposed to “conditional estimation”, which takes each group mean to be the appropriate linear combination of the relevant <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\delta\)</span> parameters, without using <span class="math inline">\(\beta\)</span> components or going through fitted values. If the baseline covariates are balanced across studies, unconditional and conditional estimation should produce similar estimates of control and treatment effects. This approach to post-processing is explained in section III.C of the <a href="https://www.fda.gov/media/148910/download" class="external-link">FDA draft guidance on adjusting for covariates</a>.</p>
</div>
<div class="section level3">
<h3 id="mixture-model">Mixture model<a class="anchor" aria-label="anchor" href="#mixture-model"></a>
</h3>
<p>Functions:</p>
<ul>
<li><code><a href="../reference/hb_sim_mixture.html">hb_sim_mixture()</a></code></li>
<li><code><a href="../reference/hb_mcmc_mixture.html">hb_mcmc_mixture()</a></code></li>
</ul>
<p>The mixture model analyzes only the data from the current study, so we use <span class="math inline">\(X_\alpha^{\text{mixture}}\)</span> instead of <span class="math inline">\(X_\alpha\)</span>. <span class="math inline">\(X_\alpha^{\text{mixture}}\)</span> is a one-column matrix to indicate which elements of <span class="math inline">\(y\)</span> are part of the control group of the current study.</p>
<p>The historical studies contribute to the model through hyperparameters <span class="math inline">\(({m_\omega})_i\)</span> and <span class="math inline">\((s_\omega)_i\)</span>. If study <span class="math inline">\(i\)</span> is a historical study, <span class="math inline">\(({m_\omega})_i\)</span> and <span class="math inline">\((s_\omega)_i\)</span> are the posterior mean and posterior standard deviation, respectively, of the mean control group response estimated from the simple model described later. If study <span class="math inline">\(i\)</span> is the current study, <span class="math inline">\(({m_\omega})_i\)</span> and <span class="math inline">\((s_\omega)_i\)</span> are chosen so the mixture component Normal(<span class="math inline">\(({m_\omega})_i\)</span>, <span class="math inline">\((s_\omega)_i\)</span>) of study <span class="math inline">\(i\)</span> is diffuse and non-informative. Variable <span class="math inline">\(\omega_i\)</span> of study <span class="math inline">\(i\)</span> is the latent variable of mixture component <span class="math inline">\(i\)</span>, and the index variable <span class="math inline">\(\pi\)</span> chooses which <span class="math inline">\(\omega_i\)</span> to use for the current study control group mean <span class="math inline">\(\alpha\)</span>. Hyperparameter <span class="math inline">\(p_\omega\)</span> is a constant vector of prior mixture proportions of each study. The posterior histogram of <span class="math inline">\(\pi\)</span> gives the posterior mixture proportions.</p>
<p><span class="math display">\[
\begin{aligned}
&amp; y_{ij}  \stackrel{\text{ind}}{\sim} \text{N} \left ( \left (X_\alpha^{\text{mixture}} \alpha + X_\delta \delta + X_\beta \beta \right )_{ij}, \ \sigma^2 \right) \\
&amp; \qquad \alpha = \omega_{\pi} \\
&amp; \qquad \qquad \omega_i \stackrel{\text{ind}}{\sim} \text{Normal}(({m_\omega})_i, (s_\omega)_i^2) \\
&amp; \qquad \qquad \pi \sim \text{Categorical}(p_\omega) \\
&amp; \qquad \delta_d \stackrel{\text{ind}}{\sim} \text{Normal} (0, s_\delta^2) \\
&amp; \qquad \beta_b \sim \text{Normal} (0, s_\beta^2) \\
&amp; \qquad \sigma \sim \text{Uniform}(0, s_\sigma)
\end{aligned} 
\]</span></p>
</div>
<div class="section level3">
<h3 id="hierarchical-model">Hierarchical model<a class="anchor" aria-label="anchor" href="#hierarchical-model"></a>
</h3>
<p>Functions:</p>
<ul>
<li><code><a href="../reference/hb_sim_hierarchical.html">hb_sim_hierarchical()</a></code></li>
<li><code><a href="../reference/hb_mcmc_hierarchical.html">hb_mcmc_hierarchical()</a></code></li>
<li><code><a href="../reference/hb_s_tau.html">hb_s_tau()</a></code></li>
</ul>
<p>The hierarchical model analyzes the data from all studies and shrinks the control group means <span class="math inline">\(\alpha_i\)</span> towards a common normal distribution with mean <span class="math inline">\(\mu\)</span> and variance <span class="math inline">\(\tau^2\)</span>.</p>
<p><span class="math display">\[
\begin{aligned}
&amp; y_{ij} \sim \text{N} \left( \left (X_\alpha \alpha + X_\delta \delta + X_\beta \beta \right )_{ij} , \ \sigma_i^2 \right )\\
&amp; \qquad \alpha_i \stackrel{\text{ind}}{\sim} \text{Normal}(\mu, \tau^2) \\
&amp; \qquad \qquad \mu \sim \text{Normal}(0, s_\mu^2) \\
&amp; \qquad \qquad \tau \sim \text{Uniform}(0, s_\tau) \\
&amp; \qquad \delta_d \stackrel{\text{ind}}{\sim} \text{Normal} (0, s_\delta^2) \\
&amp; \qquad \beta_b \stackrel{\text{ind}}{\sim} \text{Normal} (0, s_\beta^2) \\
&amp; \qquad \sigma_i \stackrel{\text{ind}}{\sim} \text{Uniform}(0, s_\sigma)
\end{aligned} 
\]</span></p>
</div>
<div class="section level3">
<h3 id="independent-model">Independent model<a class="anchor" aria-label="anchor" href="#independent-model"></a>
</h3>
<p>Functions:</p>
<ul>
<li><code><a href="../reference/hb_sim_independent.html">hb_sim_independent()</a></code></li>
<li><code><a href="../reference/hb_mcmc_independent.html">hb_mcmc_independent()</a></code></li>
</ul>
<p>The independent model is the same as the hierarchical model, but with independent control group parameters <span class="math inline">\(\alpha\)</span>. We use it as a no-borrowing benchmark to quantify the borrowing strength of the hierarchical model and the mixture model.</p>
<p><span class="math display">\[
\begin{aligned}
&amp; y_{ij} \sim \text{N} \left( \left (X_\alpha \alpha + X_\delta \delta + X_\beta \beta \right )_{ij} , \ \sigma_i^2 \right )\\
&amp; \qquad \alpha_i \stackrel{\text{ind}}{\sim} \text{Normal}(0, s_\alpha^2) \\
&amp; \qquad \delta_d \stackrel{\text{ind}}{\sim} \text{Normal} (0, s_\delta^2) \\
&amp; \qquad \beta_b \stackrel{\text{ind}}{\sim} \text{Normal} (0, s_\beta^2) \\
&amp; \qquad \sigma_i \stackrel{\text{ind}}{\sim} \text{Uniform}(0, s_\sigma)
\end{aligned} 
\]</span></p>
</div>
<div class="section level3">
<h3 id="pooled-model">Pooled model<a class="anchor" aria-label="anchor" href="#pooled-model"></a>
</h3>
<p>Functions:</p>
<ul>
<li><code><a href="../reference/hb_sim_pool.html">hb_sim_pool()</a></code></li>
<li><code><a href="../reference/hb_mcmc_pool.html">hb_mcmc_pool()</a></code></li>
</ul>
<p>Like the independent model, the pooled model is a benchmark to quantify the borrowing strength of the hierarchical model and the mixture model. But instead of the no-borrowing independent model, the pooled model represents maximum borrowing. Instead of <span class="math inline">\(X_\alpha\)</span>, below, we use <span class="math inline">\(X_\alpha^{\text{pool}}\)</span>, which has only one column to indicate which observations belong to any control group. In other words, the <span class="math inline">\(\alpha\)</span> parameters are pooled, and <span class="math inline">\(\alpha\)</span> itself is a scalar.</p>
<p><span class="math display">\[
\begin{aligned}
&amp; y_{ij} \sim \text{N} \left( \left ( X_\alpha^{\text{pool}} \alpha + X_\delta \delta + X_\beta \beta \right )_{ij} , \ \sigma_i^2 \right )\\
&amp; \qquad \alpha \sim \text{Normal}(0, s_\alpha^2) \\
&amp; \qquad \delta_d \stackrel{\text{ind}}{\sim} \text{Normal} (0, s_\delta^2) \\
&amp; \qquad \beta_b \stackrel{\text{ind}}{\sim} \text{Normal} (0, s_\beta^2) \\
&amp; \qquad \sigma_i \stackrel{\text{ind}}{\sim} \text{Uniform}(0, s_\sigma)
\end{aligned} 
\]</span></p>
</div>
<div class="section level3">
<h3 id="simple-model">Simple model<a class="anchor" aria-label="anchor" href="#simple-model"></a>
</h3>
<p>Functions:</p>
<ul>
<li><code><a href="../reference/hb_mcmc_mixture_hyperparameters.html">hb_mcmc_mixture_hyperparameters()</a></code></li>
</ul>
<p>The mixture model hyperparameters <span class="math inline">\((m_\omega)_i\)</span> and <span class="math inline">\((s_\omega)_i\)</span> of study <span class="math inline">\(i\)</span> are obtained by analyzing the control group data of study <span class="math inline">\(i\)</span> with the simple model below. <span class="math inline">\((m_\omega)_i\)</span> and <span class="math inline">\((s_\omega)_i\)</span> are taken to be the estimated posterior mean and posterior standard deviation, respectively, of <span class="math inline">\(\mu\)</span> from this model.</p>
<p><span class="math display">\[
\begin{aligned}
&amp;y \sim \text{Normal}(\mu, \sigma^2) \\
&amp; \qquad \mu \sim \text{Normal}(0, s_\mu^2) \\
&amp; \qquad \sigma \sim \text{Uniform}(0, s_\sigma)
\end{aligned}
\]</span></p>
</div>
</div>
<div class="section level2">
<h2 id="borrowing-metrics">Borrowing metrics<a class="anchor" aria-label="anchor" href="#borrowing-metrics"></a>
</h2>
<div class="section level3">
<h3 id="mean-shift-ratio">Mean shift ratio<a class="anchor" aria-label="anchor" href="#mean-shift-ratio"></a>
</h3>
<p>Let <span class="math inline">\(\theta_m\)</span> be the posterior mean control group response estimated by model <span class="math inline">\(m\)</span>. The mean shift ratio is:</p>
<p><span class="math display">\[
\begin{aligned}
\frac{\theta_{m*} - \theta_{\text{independent}}}{\theta_{\text{pool}} - \theta_{\text{independent}}}
\end{aligned}
\]</span></p>
<p>where <span class="math inline">\(m*\)</span> is a historical borrowing model like the mixture model or hierarchical model.</p>
</div>
<div class="section level3">
<h3 id="variance-shift-ratio">Variance shift ratio<a class="anchor" aria-label="anchor" href="#variance-shift-ratio"></a>
</h3>
<p>Let <span class="math inline">\(V_m\)</span> be the estimated posterior variance of <span class="math inline">\(\alpha_I\)</span> (current study control group response mean) estimated by model <span class="math inline">\(m\)</span>. The variance shift ratio is:</p>
<p><span class="math display">\[
\begin{aligned}
\frac{V_{m*} - V_{\text{independent}}}{V_{\text{pool}} - V_{\text{independent}}}
\end{aligned}
\]</span></p>
<p>where <span class="math inline">\(m*\)</span> is a historical borrowing model like the mixture model or hierarchical model.</p>
</div>
<div class="section level3">
<h3 id="precision-ratio-hierarchical-model-only">Precision ratio (hierarchical model only)<a class="anchor" aria-label="anchor" href="#precision-ratio-hierarchical-model-only"></a>
</h3>
<p>The precision ratio compares the prior precision of a control mean response (an <span class="math inline">\(\alpha\)</span> component, numerator) to the analogous precision of the full conditional distribution (denominator). The former is <span class="math inline">\(\frac{1}{\tau^2}\)</span>, and the latter is <span class="math inline">\(\frac{1}{\tau^2} + \frac{n}{\sigma^2}\)</span>. Here, <span class="math inline">\(n\)</span> is the number of non-missing patients in the current study, <span class="math inline">\(\sigma^2\)</span> is the residual variance, and <span class="math inline">\(\tau^2\)</span> is the variance of study-specific control means (components of <span class="math inline">\(\alpha\)</span>). The full precision ratio is:</p>
<p><span class="math display">\[
\begin{aligned}
\frac{\frac{1}{\tau^2}}{\frac{1}{\tau^2} + \frac{n}{\sigma^2}}
\end{aligned}
\]</span></p>
<p>The precision ratio comes from the conditional distribution of <span class="math inline">\(\alpha_k\)</span> in the hierarchical model given the other parameters and the data. More precisely, in this conditional distribution, the mean is a weighted average between the prior mean and data mean, and the precision ratio is the weight on the prior mean. This can be seen in a simpler case with a Bayesian model with a normal data model, a normal prior on the mean, and known constant variance. For details, see Chapter 2 of <a href="http://www.stat.columbia.edu/~gelman/book/" class="external-link">Bayesian Data Analysis</a> 3rd Ed. by Gelman et al.</p>
</div>
<div class="section level3">
<h3 id="adjusting-hierarchical-borrowing-strength-using-the-prior">Adjusting hierarchical borrowing strength using the prior<a class="anchor" aria-label="anchor" href="#adjusting-hierarchical-borrowing-strength-using-the-prior"></a>
</h3>
<p>It is almost always best to set a diffuse prior on <span class="math inline">\(\tau\)</span> so that hierarchical borrowing is fully dynamic. However, in extreme cases (e.g. few historical studies, combined with other issues), there may not be enough information to precisely estimate a variance among placebo means in the hierarchical model, the function <code><a href="../reference/hb_s_tau.html">hb_s_tau()</a></code> suggests a value of <span class="math inline">\(s_\tau\)</span> that assigns a desired prior precision ratio. if <span class="math inline">\(P\)</span> is the desired prior precision ratio, then:</p>
<p><span class="math display">\[
\begin{aligned}
P = \frac{\frac{1}{\tau^2}}{\frac{1}{\tau^2} + \frac{n}{\sigma^2}}
\end{aligned}
\]</span></p>
<p>Solving for <span class="math inline">\(\tau\)</span>:</p>
<p><span class="math display">\[
\begin{aligned}
\tau = \sigma \sqrt{\frac{1}{n} \left (\frac{1}{P} - 1 \right )}
\end{aligned}
\]</span></p>
<p>If we expect the mean of <span class="math inline">\(\tau\)</span> to be as above, then our uniform upper bound is double:</p>
<p><span class="math display">\[
\begin{aligned}
s_\tau = 2 \sigma \sqrt{\frac{1}{n} \left (\frac{1}{P} - 1 \right )}
\end{aligned}
\]</span></p>
</div>
<div class="section level3">
<h3 id="posterior-mixture-proportions-mixture-model-only">Posterior mixture proportions (mixture model only)<a class="anchor" aria-label="anchor" href="#posterior-mixture-proportions-mixture-model-only"></a>
</h3>
<p>The posterior mixture proportion of study <span class="math inline">\(i\)</span> is <span class="math inline">\(P(\pi = i)\)</span>, and it is obtained by averaging posterior samples of <span class="math inline">\(\pi\)</span>.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by William Michael Landau.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
